<!-- if authenticated user, show welcome message -->
{{#if user}}
  <h1>Welcome back, {{user.username}}!</h1>


  <p>Here are the latest posts in your area ({{user.zipcode}}):</p>

  <div class="create-post-banner">
    <p>Have something to add?</p>
    <button onclick="window.location.href='/posts/create'" class="button-primary">Create New Post</button>
  </div>


  <div class="filters">
        <form id="filter-form">
            <div class="filter-group">
                <label for="distance">Distance:</label>
                <select name="distance" id="distance">
                    <option value="5">5 miles</option>
                    <option value="10" selected>10 miles</option>
                    <option value="25">25 miles</option>
                    <option value="50">50 miles</option>
                    <option value="100">100 miles</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="category">Category:</label>
                <select name="category" id="category">
                    <option value="">All Categories</option>
                    {{#each categories}}
                        <option value="{{this.value}}">{{this.label}}</option>
                    {{/each}}
                </select>
            </div>

            <div class="filter-group">
                <label for="type">Type:</label>
                <select name="type" id="type">
                    <option value="">All Types</option>
                    {{#each postTypes}}
                        <option value="{{this}}">{{this}}</option>
                    {{/each}}
                </select>
            </div>

            <div class="filter-group">
                <label for="tags">Tags (comma-separated):</label>
                <input type="text" name="tags" id="tags" placeholder="e.g. urgent, local">
            </div>

            <div class="filter-group">
                <label for="priority">Priority:</label>
                <select name="priority" id="priority">
                    <option value="">All Priorities</option>
                    {{#each priorityValues}}
                        <option value="{{this.value}}">{{this.label}}</option>
                    {{/each}}
                </select>
            </div>

            <div class="filter-group">
                <label for="expiring">Expiration:</label>
                <select name="expiring" id="expiring">
                    <option value="">All Posts</option>
                    <option value="24h">Expiring in 24 hours</option>
                    <option value="3d">Expiring in 3 days</option>
                    <option value="7d">Expiring in 7 days</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="sortBy">Sort by:</label>
                <select name="sortBy" id="sortBy">
                    <option value="distance">Distance</option>
                    <option value="newest" selected>Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="expiration">Expiration Date</option>
                    <option value="priority">Priority</option>
                </select>
            </div>

            <button type="submit">Apply Filters</button>
        </form>
    </div>

    {{#if posts.length}}
        <ul id="posts-container">
        {{#each posts}}
            <li>
                <article class="post-item">
                <h3>{{this.title}}</h3>
                <p class="post-meta">{{this.category}} • {{this.type}} • {{this.city}}, {{this.state}}</p>
                <p class="posted-by">Posted by {{this.username}} on {{this.datePosted}}</p>
                <p class="post-preview">{{this.content}}</p>
                <a href="/posts/{{this._id}}">Read more</a>
                </article>
            </li>
        {{/each}}
        </ul>
        <div class="load-more-container">
            <button id="load-more-btn" class="load-more-btn">Load More Posts</button>
            <p id="loading-message" style="display: none;">Loading...</p>
            <p id="no-more-posts" style="display: none;">No more posts to load</p>
        </div>
    {{else}}
        <p>No posts available in your area at the moment. Please check back later!</p>
    {{/if}}



{{else}}
  <h1>Welcome to Our Community!</h1>
  <p>Please log in or sign up to see posts in your area.</p>
{{/if}}

{{#if user}}
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
<script src="/public/js/loadPosts.js"></script>
{{/if}}