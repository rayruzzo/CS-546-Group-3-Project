<article id="{{post._id}}">
    <h1>{{post.title}}</h1>

    {{#if isPostOwner}}
    <div class="post-actions">
        <a href="/posts/edit/{{post._id}}" class="button-primary">Update Post</a>
        <button class="button-danger">Delete Post</button>
        {{#if (eq post.fulfilledState "open")}}
            <button id="fulfill-post-btn" class="button-secondary">Mark as Fulfilled</button>
        {{/if}}
    </div>
{{/if}}

    <div class="post-meta">
        <span class="author">Posted by <strong>{{post.username}}</strong></span>
        <span class="location">üìç {{post.city}}, {{post.state}}</span>
        <span class="date">
            <time datetime="{{post.createdAt}}">{{post.datePosted}}</time>
        </span>
        {{#if (eq post.fulfilledState "fulfilled")}}
            <span class="status fulfilled">‚úÖ Fulfilled</span>
        {{/if}}
    </div>

    <div class="post-details">
        <span class="type {{post.type}}">{{post.type}}</span>
        <span class="category">{{post.category}}</span>
        <span class="priority priority-{{post.priority}}">
            {{#if (eq post.priority 4)}}üî¥ Urgent
            {{else if (eq post.priority 3)}}üü† High Priority
            {{else if (eq post.priority 2)}}üü° Normal
            {{else}}üü¢ Low Priority
            {{/if}}
        </span>
        {{#if post.expiresAt}}
        <span class="expiration">
            Expires: <time datetime="{{post.expiresAt}}">{{formatDate post.expiresAt}}</time>
        </span>
        {{/if}}
        {{#if post.tags}}
        <div class="tags">
            {{#each post.tags}}
            <span class="tag">{{this}}</span>
            {{/each}}
        </div>
        {{/if}}
    </div>

    <div class="content">{{post.content}}</div>
    {{#if post.commentsEnabled}}
    {{#unless post.reported}}
    <section id="comments-section">
        <h2>Comments</h2>

        <div class="add-comment">
            {{#if user}}
            <h3>Add a Comment</h3>
            <form id="comment-form" method="POST" action="/comments/create/{{post._id}}" data-post-id="{{post._id}}">
                <textarea id="comment-content" name="content" placeholder="Write your comment here..." required></textarea>
                <button type="submit" id="submit-comment" class="button-primary">Submit Comment</button>
            </form>
            {{else}}
            <p>Please <a href="/login">log in</a> to add a comment.</p>
            {{/if}}

        </div>
        {{#if comments.length}}
        <div id="comments-list">
            {{#each comments}}
            <div class="comment" id="comment-{{this._id}}">
                <div class="comment-meta">
                    <span class="comment-author"><strong>{{this.username}}</strong></span>
                    <span class="comment-date">
                        <time datetime="{{this.createdAt}}">{{this.datePosted}}</time>
                    </span>
                    {{#if this.isOwner}}
                    <span class="comment-actions">
                        <a href="/comments/edit/{{this._id}}" class="comment-edit">Edit</a>
                        <button class="comment-delete button-danger" data-comment-id="{{this._id}}">Delete</button>
                    </span>
                    {{/if}}
                </div>
                <div class="comment-content">{{this.content}}</div>
            </div>
            {{/each}}
        </div>
        {{/if}}
    </section>
    {{/unless}}
    {{/if}}
</article>

<div class="report-post-section">
  {{#if user}}
    {{#unless isPostOwner}}

      {{#if post.reported}}
        <p class="report-post-message">
          ‚ö† This post has been reported. Thank you for helping us keep the community safe.
        </p>
      {{else}}
        <p class="report-post-message">
          If you find this post inappropriate or violating our community guidelines, you can report it.
        </p>
        <form action="/posts/report/{{post._id}}" method="post">
          <button
            type="submit"
            id="report-post-btn"
            class="button-secondary">
           ‚ö† Report Post
          </button>
        </form>
      {{/if}}

    {{/unless}}
  {{/if}}
</div>

{{!-- conditionally load postManagement javascript if we are the post owner --}}
{{#if isPostOwner}}
<script src="/public/js/postManagement.js"></script>
<script src="/public/js/commentManagement.js"></script>

{{/if}}

<script src="/public/js/submitComment.js"></script>