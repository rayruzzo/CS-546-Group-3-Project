<article id="{{post._id}}">
    <h1>{{post.title}}</h1>

    {{#if isPostOwner}}
    <div class="post-actions">
        <a href="/posts/edit/{{post._id}}" class="button-primary">Update Post</a>
        <button class="button-danger">Delete Post</button>
        {{#if (eq post.fulfilledState "open")}}
            <button id="fulfill-post-btn" class="button-secondary">Mark as Fulfilled</button>
        {{/if}}
    </div>
{{/if}}

    <div class="post-meta">
        <span class="author">Posted by <strong>{{post.username}}</strong></span>
        <span class="location">üìç {{post.city}}, {{post.state}}</span>
        <span class="date">
            <time datetime="{{post.createdAt}}">{{post.datePosted}}</time>
        </span>
        {{#if (eq post.fulfilledState "fulfilled")}}
            <span class="status fulfilled">‚úÖ Fulfilled</span>
        {{/if}}
    </div>

    <div class="post-details">
        <span class="type {{post.type}}">{{post.type}}</span>
        <span class="category">{{post.category}}</span>
        <span class="priority priority-{{post.priority}}">
            {{#if (eq post.priority 4)}}üî¥ Urgent
            {{else if (eq post.priority 3)}}üü† High Priority
            {{else if (eq post.priority 2)}}üü° Normal
            {{else}}üü¢ Low Priority
            {{/if}}
        </span>
        {{#if post.expiresAt}}
        <span class="expiration">
            Expires: <time datetime="{{post.expiresAt}}">{{formatDate post.expiresAt}}</time>
        </span>
        {{/if}}
        {{#if post.tags}}
        <div class="tags">
            {{#each post.tags}}
            <span class="tag">{{this}}</span>
            {{/each}}
        </div>
        {{/if}}
    </div>

    <div class="content">{{post.content}}</div>
    {{#if user}}
        {{#unless isPostOwner}}

            {{#if post.reported}}
            <span class="post-reported-status">
                ‚ö† Reported
            </span>
            {{else}}
            <form method="POST"
                    action="/posts/report/{{post._id}}"
                    class="report-form">
                <button type="submit" class="report-link">
                Report
                </button>
            </form>
            {{/if}}
        {{/unless}}
    {{/if}}

    {{#if post.commentsEnabled}}
    {{#unless post.reported}}
<!-- Comments Section Placeholder -->
    {{/unless}}
    {{/if}}
</article>

<div class="report-post-section">
    <p class="report-post-message">
        {{#if post.reported}}
            This post has been reported. Thank you for helping us keep the community safe.
        {{else}}
            If you find this post inappropriate or violating our community guidelines, you can report it.
            <form action="/posts/report/{{post._id}}" method="post" style="display:inline;">
            <button type="submit" id="report-post-btn" class="button-secondary">Report Post</button>
            </form>
        {{/if}}
    </p>
</div>

{{!-- conditionally load postManagement javascript if we are the post owner --}}
{{#if isPostOwner}}
<script src="/public/js/postManagement.js"></script>
{{/if}}
